# -*- coding: utf-8 -*-
"""Mini-project-LEE.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1ibjAIvk0qKtI_o1tN8EZSvWRz5sryZJi
"""

# âœ… 1. í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
!pip install streamlit pyngrok --quiet

# âœ… 2. ngrok ì¸ì¦ í† í° ë“±ë¡ (ğŸ‘‰ ngrok ê°€ì… í›„ ë°›ì€ í† í°ìœ¼ë¡œ êµì²´í•˜ì„¸ìš”)
# í† í°ì€ https://dashboard.ngrok.com/get-started/your-authtoken ì—ì„œ í™•ì¸ ê°€ëŠ¥
!ngrok config add-authtoken 2yP4Gt799Muq4gpuqxZ48CS7DQm_2coEa2vioWcycKYcDjAh3

# âœ… 3. Streamlit ì•± ì½”ë“œ ì €ì¥ (Met Museum API ì—°ë™)
code = """
import streamlit as st
import requests

st.set_page_config(page_title='ğŸ¨ ì˜ˆìˆ  ì‘í’ˆ íƒìƒ‰ê¸°', layout='wide')
st.title("ğŸ–¼ï¸ ë©”íŠ¸ë¡œí´ë¦¬íƒ„ ë¯¸ìˆ ê´€ ì‘í’ˆ íƒìƒ‰ê¸°")

object_id = st.number_input("ğŸ” ì‘í’ˆ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”", min_value=1, value=436535)

@st.cache_data
def get_artwork(object_id):
    url = f"https://collectionapi.metmuseum.org/public/collection/v1/objects/{object_id}"
    res = requests.get(url)
    return res.json() if res.status_code == 200 else {}

if st.button("ì‘í’ˆ ì¡°íšŒ"):
    data = get_artwork(object_id)
    if data.get("objectID"):
        st.subheader(data.get("title", "ì œëª© ì—†ìŒ"))
        if data.get("primaryImageSmall"):
            st.image(data["primaryImageSmall"], caption=data.get("artistDisplayName", ""), use_column_width=True)
        info_md = f'''
- ğŸ‘¨â€ğŸ¨ ì‘ê°€: **{data.get("artistDisplayName", "ì •ë³´ ì—†ìŒ")}**
- ğŸ•° ì œì‘ì—°ë„: **{data.get("objectDate", "ë¯¸ìƒ")}**
- ğŸ› ë¶€ì„œ: {data.get("department", "ì •ë³´ ì—†ìŒ")}
- ğŸ“ ì„¤ëª…: {data.get("creditLine", "ì •ë³´ ì—†ìŒ")}
'''
        st.markdown(info_md)
    else:
        st.error("í•´ë‹¹ IDì— ëŒ€í•œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
"""

# âœ… 4. ì½”ë“œ íŒŒì¼ë¡œ ì €ì¥
with open("app.py", "w") as f:
    f.write(code)

# âœ… 5. ngrokìœ¼ë¡œ í¬íŠ¸ í„°ë„ë§ ì—°ê²°
from pyngrok import ngrok
public_url = ngrok.connect(8501)
print(f"ğŸŒ ì—¬ê¸°ë¥¼ í´ë¦­í•´ì„œ Streamlit ì•± ì—´ê¸° ğŸ‘‰ {public_url}")

# âœ… 6. Streamlit ì•± ì‹¤í–‰
!streamlit run app.py &> /dev/null &

# í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜
!pip install requests

# API í˜¸ì¶œ í•¨ìˆ˜ ì •ì˜
import requests

# ì‘í’ˆ ê²€ìƒ‰
def search_artworks(query):
    url = "https://collectionapi.metmuseum.org/public/collection/v1/search"
    params = {"q": query}
    response = requests.get(url, params=params)
    response.raise_for_status()
    return response.json().get("objectIDs", [])

# íŠ¹ì • objectIDì˜ ìƒì„¸ì •ë³´
def get_artwork_details(object_id):
    url = f"https://collectionapi.metmuseum.org/public/collection/v1/objects/{object_id}"
    response = requests.get(url)
    response.raise_for_status()
    return response.json()

# í…ŒìŠ¤íŠ¸: "van Gogh" ê²€ìƒ‰
object_ids = search_artworks("van Gogh")
print(f"ê²€ìƒ‰ëœ ì‘í’ˆ ìˆ˜: {len(object_ids)}")
print(f"ì²« 5ê°œ objectID: {object_ids[:5]}")

# ì²« ë²ˆì§¸ ì‘í’ˆ ìƒì„¸ì •ë³´ ì¶œë ¥
if object_ids:
    details = get_artwork_details(object_ids[0])
    print("ì‘í’ˆ ì œëª©:", details.get("title"))
    print("ì‘ê°€ëª…:", details.get("artistDisplayName"))
    print("ì œì‘ë…„ë„:", details.get("objectDate"))
    print("ì´ë¯¸ì§€ URL:", details.get("primaryImageSmall"))

# app.py
import streamlit as st
import requests

# API í•¨ìˆ˜
def search_artworks(query):
    url = "https://collectionapi.metmuseum.org/public/collection/v1/search"
    params = {"q": query}
    response = requests.get(url, params=params)
    response.raise_for_status()
    return response.json().get("objectIDs", [])

def get_artwork_details(object_id):
    url = f"https://collectionapi.metmuseum.org/public/collection/v1/objects/{object_id}"
    response = requests.get(url)
    response.raise_for_status()
    return response.json()

# Streamlit UI êµ¬ì„±
st.title("ğŸ¨ The Met Art Explorer")

query = st.text_input("ì‘í’ˆ í‚¤ì›Œë“œ ì…ë ¥ (ì˜ˆ: van Gogh, Monet, Picasso)")

if query:
    object_ids = search_artworks(query)
    st.write(f"ğŸ” ì´ {len(object_ids)}ê°œ ì‘í’ˆ ê²€ìƒ‰ë¨")

    if object_ids:
        for object_id in object_ids[:5]:  # ìƒìœ„ 5ê°œë§Œ í‘œì‹œ
            details = get_artwork_details(object_id)
            st.subheader(details.get("title", "ì œëª© ì—†ìŒ"))
            if details.get("primaryImageSmall"):
                st.image(details["primaryImageSmall"], width=300)
            st.write(f"ğŸ‘¨â€ğŸ¨ ì‘ê°€: {details.get('artistDisplayName', 'ì •ë³´ ì—†ìŒ')}")
            st.write(f"ğŸ—“ï¸ ì œì‘ë…„ë„: {details.get('objectDate', 'ì •ë³´ ì—†ìŒ')}")
            st.write("---")
    else:
        st.write("âŒ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.")

import requests
import pandas as pd

# 1ï¸âƒ£ Monetë¡œ ê²€ìƒ‰í•˜ê¸°
search_url = "https://collectionapi.metmuseum.org/public/collection/v1/search"
params = {
    "q": "Monet",       # ê²€ìƒ‰ í‚¤ì›Œë“œ
    "hasImages": True   # ì´ë¯¸ì§€ê°€ ìˆëŠ” ì‘í’ˆë§Œ
}

response = requests.get(search_url, params=params)
data = response.json()

print(f"ì´ ê²€ìƒ‰ ê²°ê³¼ ìˆ˜: {data['total']} ê°œ")
object_ids = data.get("objectIDs", [])[:10]  # ìƒìœ„ 10ê°œë§Œ ê°€ì ¸ì˜¤ê¸°

# 2ï¸âƒ£ objectIDë³„ ìƒì„¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
object_url = "https://collectionapi.metmuseum.org/public/collection/v1/objects/"

records = []
for obj_id in object_ids:
    obj_response = requests.get(f"{object_url}{obj_id}")
    obj_data = obj_response.json()

    records.append({
        "Title": obj_data.get("title"),
        "Artist": obj_data.get("artistDisplayName"),
        "Year": obj_data.get("objectDate"),
        "Department": obj_data.get("department"),
        "Medium": obj_data.get("medium"),
        "Image": obj_data.get("primaryImageSmall"),
    })

# 3ï¸âƒ£ DataFrameìœ¼ë¡œ ì •ë¦¬í•´ì„œ ë³´ê¸°
df = pd.DataFrame(records)
df

